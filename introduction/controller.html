<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>路由（Controller） | Nest.js完全入门指南</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/nest-doc/assets/img/logo.png">
    <meta name="description" content="涵盖入门、基础、技术、源码解析、实例教程等篇章，帮助大家更好地上手Nest.js">
    <link rel="preload" href="/nest-doc/assets/css/0.styles.58c19460.css" as="style"><link rel="preload" href="/nest-doc/assets/js/app.df150fcc.js" as="script"><link rel="preload" href="/nest-doc/assets/js/2.7019b4df.js" as="script"><link rel="preload" href="/nest-doc/assets/js/6.d2f6e020.js" as="script"><link rel="prefetch" href="/nest-doc/assets/js/10.2ffe9c5f.js"><link rel="prefetch" href="/nest-doc/assets/js/11.d7f6b6a0.js"><link rel="prefetch" href="/nest-doc/assets/js/12.dea5d80f.js"><link rel="prefetch" href="/nest-doc/assets/js/13.91e13f5c.js"><link rel="prefetch" href="/nest-doc/assets/js/14.1ee95699.js"><link rel="prefetch" href="/nest-doc/assets/js/3.6fed4b78.js"><link rel="prefetch" href="/nest-doc/assets/js/4.2b7fc900.js"><link rel="prefetch" href="/nest-doc/assets/js/5.b28f6418.js"><link rel="prefetch" href="/nest-doc/assets/js/7.4ba3416d.js"><link rel="prefetch" href="/nest-doc/assets/js/8.fe167c80.js"><link rel="prefetch" href="/nest-doc/assets/js/9.143e14c7.js">
    <link rel="stylesheet" href="/nest-doc/assets/css/0.styles.58c19460.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nest-doc/" class="home-link router-link-active"><img src="/nest-doc/assets/img/logo.png" alt="Nest.js完全入门指南" class="logo"> <span class="site-name can-hide">Nest.js完全入门指南</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nest-doc/" class="nav-link">
  入门
</a></div><div class="nav-item"><a href="https://github.com/erasermeng/nest-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nest-doc/" class="nav-link">
  入门
</a></div><div class="nav-item"><a href="https://github.com/erasermeng/nest-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/nest-doc/" aria-current="page" class="sidebar-link">准备工作</a></li><li><a href="/nest-doc/introduction/controller.html" aria-current="page" class="active sidebar-link">路由（Controller）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nest-doc/introduction/controller.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/nest-doc/introduction/controller.html#常用的参数装饰器" class="sidebar-link">常用的参数装饰器</a></li><li class="sidebar-sub-header"><a href="/nest-doc/introduction/controller.html#常用的方法装饰器" class="sidebar-link">常用的方法装饰器</a></li><li class="sidebar-sub-header"><a href="/nest-doc/introduction/controller.html#路由通配符" class="sidebar-link">路由通配符</a></li><li class="sidebar-sub-header"><a href="/nest-doc/introduction/controller.html#请求参数与-dto" class="sidebar-link">请求参数与 Dto</a></li></ul></li><li><a href="/nest-doc/introduction/provider.html" class="sidebar-link">供应（Provider）</a></li><li><a href="/nest-doc/introduction/module.html" class="sidebar-link">模块（Module）</a></li><li><a href="/nest-doc/introduction/middleware.html" class="sidebar-link">中间件（Middleware）</a></li><li><a href="/nest-doc/introduction/exception_filter.html" class="sidebar-link">异常过滤器（Exception Filter）</a></li><li><a href="/nest-doc/introduction/pipe.html" class="sidebar-link">管道（Pipe）</a></li><li><a href="/nest-doc/introduction/guard.html" class="sidebar-link">守卫（Guard）</a></li><li><a href="/nest-doc/introduction/interceptor.html" class="sidebar-link">拦截器（Interceptor）</a></li><li><a href="/nest-doc/introduction/custom_decorator.html" class="sidebar-link">自定义装饰器（Custom Decorator）</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="路由（controller）"><a href="#路由（controller）" class="header-anchor">#</a> 路由（Controller）</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p><code>Nest.js</code>通过独立的<code>Controller</code>文件组织来规范化后台路由设计。在<code>Controller</code>中，我们通过<code>@Controller</code>装饰器修饰路由类，通过<code>http</code>方法装饰器修饰具体的路由方法：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@nestjs/common&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">&quot;cats&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CatsController</span> <span class="token punctuation">{</span>
  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;This action returns all cats&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述例子中，定义了一个<code>/cats</code>的路由，支持以<code>GET</code>方式调用，返回一个字符串。</p> <p>默认情况下，直接使用<code>return</code>，未发生异常时，接口会返回<code>200</code>状态码(<code>POST</code>为<code>201</code>)，<code>Nest</code>会自动帮我们序列化数据，返回<code>JSON</code>格式或原始值数据，我们只需要关心返回什么数据，格式的封装可以交由<code>Nest</code>。</p> <p>当然，如果想自主地控制返回，可以使用<code>@Res</code>装饰器，拿到原始的<code>response</code>对象（默认为<code>Express</code>）：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Res<span class="token punctuation">,</span> HttpStatus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@nestjs/common&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Response <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;express&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">&quot;cats&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CatsController</span> <span class="token punctuation">{</span>
  @<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">@<span class="token function">Res</span><span class="token punctuation">(</span><span class="token punctuation">)</span> res<span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span><span class="token constant">CREATED</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token parameter">@<span class="token function">Res</span><span class="token punctuation">(</span><span class="token punctuation">)</span> res<span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>同理，我们也可以使用<code>@Req</code>来获取原始<code>req</code>对象。</p> <h2 id="常用的参数装饰器"><a href="#常用的参数装饰器" class="header-anchor">#</a> 常用的参数装饰器</h2> <p>大多数情况下，我们是不需要使用<code>@Res</code>和<code>@Req</code>来获取原始对象的，因为<code>Nest</code>提供了很多便捷的装饰器：</p> <ul><li><code>@Session()</code>，拿到<code>req.session</code></li> <li><code>@Param(key?: string)</code>，拿到<code>req.params / req.params[key]</code></li> <li><code>@Body(key?: string)</code>，拿到<code>req.body / req.body[key]</code></li> <li><code>@Query(key?: string)</code>，拿到<code>req.query / req.query[key]</code></li> <li><code>@Headers(name?: string)</code>，拿到<code>req.headers / req.headers[name]</code></li> <li><code>@Ip()</code>，拿到<code>req.ip</code></li> <li><code>@Next()</code>，获取到<code>Next</code>方法</li></ul> <p>示例：</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
<span class="token function">findOne</span><span class="token punctuation">(</span>@<span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">This action returns a #</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> cat</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="常用的方法装饰器"><a href="#常用的方法装饰器" class="header-anchor">#</a> 常用的方法装饰器</h2> <p>对于<code>Res</code>的操作，Nest 也提供了一些常用的装饰器（注意装饰器用来修饰方法）：</p> <h3 id="http-方法装饰器"><a href="#http-方法装饰器" class="header-anchor">#</a> HTTP 方法装饰器</h3> <ul><li><code>@Get(path?: string)</code>，响应<code>Get</code>请求</li> <li><code>@Post(path?: string)</code>，响应<code>Post</code>请求</li> <li><code>@Delete(path?: string)</code>，响应<code>Delete</code>请求</li> <li><code>@Put(path?: string)</code>，响应<code>Put</code>请求</li> <li><code>@Options(path?: string)</code>，响应<code>Options</code>请求</li> <li><code>@Head(path?: string)</code>，响应<code>Head</code>请求</li> <li><code>@All(path?: string)</code>，响应所有请求</li></ul> <h3 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h3> <ul><li><code>@HttpCode(statusCode: number)</code>，响应状态码</li> <li><code>@Header(name: string, value: string)</code>，指定响应头</li> <li><code>@Redirect(url: string, statusCode?: number)</code>，重定向</li></ul> <h3 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
@<span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">'Cache-Control'</span><span class="token punctuation">,</span> <span class="token string">'none'</span><span class="token punctuation">)</span>
@<span class="token function">HttpCode</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span>
@<span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token string">'https://nestjs.com'</span><span class="token punctuation">,</span> <span class="token number">301</span><span class="token punctuation">)</span>
<span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'This action adds a new cat'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="路由通配符"><a href="#路由通配符" class="header-anchor">#</a> 路由通配符</h2> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">'ab*cd'</span><span class="token punctuation">)</span>
<span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'This route uses a wildcard'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>?*+()-.</code>等正则表达式的子集也是可以用的，具体可以参见<a href="https://github.com/pillarjs/path-to-regexp" target="_blank" rel="noopener noreferrer">path-to-regexp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="请求参数与-dto"><a href="#请求参数与-dto" class="header-anchor">#</a> 请求参数与 Dto</h2> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">@<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> createCatDto<span class="token operator">:</span> CreateCatDto</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'This action adds a new cat'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>拿到请求参数后，我们经常需要做一些操作，比如存储数据库等，那么这样的数据需要经过校验、转换的环节，如何更加规范地定义和使用这种传输中的数据，<code>Nest</code>推荐声明<code>DTO</code>：</p> <p><code>DTO(Data Transfer Object)</code>这个概念实际上体现的是分层设计架构，最早应用于<code>J2EE</code>企业级架构解决方案，数据库中的数据和视图层所需要的数据是有差异的，在各层之间需要转换传输的对象抽象为<code>DTO</code>。</p> <p>在维基百科中将<code>DTO</code>定义为在进程中传输的数据对象，尤其是远程调用场景。更宽泛的说，DTO 定义了在网络上是以什么样的格式传输的。</p> <blockquote><p>In the field of programming a data transfer object (DTO[1][2]) is an object that carries data between processes. The motivation for its use is that communication between processes is usually done resorting to remote interfaces (e.g., web services), where each call is an expensive operation.[2] Because the majority of the cost of each call is related to the round-trip time between the client and the server, one way of reducing the number of calls is to use an object (the DTO) that aggregates the data that would have been transferred by the several calls, but that is served by one call only.[2]</p></blockquote> <p>在<code>Nest</code>中，我们可以使用<code>Class</code>来定义<code>DTO</code>，当然使用<code>interface</code>也是可以的，不过<code>Class</code>的方式更有助后续结合<code>Pipe</code>可以在<code>DTO</code>上做更多事情（如校验等），也可以让<code>Nest</code>在运行态感知<code>DTO</code>的存在。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CreateCatDto</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  breed<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nest-doc/" class="prev router-link-active">
        准备工作
      </a></span> <span class="next"><a href="/nest-doc/introduction/provider.html">
        供应（Provider）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/nest-doc/assets/js/app.df150fcc.js" defer></script><script src="/nest-doc/assets/js/2.7019b4df.js" defer></script><script src="/nest-doc/assets/js/6.d2f6e020.js" defer></script>
  </body>
</html>
